// <auto-generated/>
#pragma warning disable 1591
#pragma warning disable 0414
#pragma warning disable 0649
#pragma warning disable 0169

namespace LibraryServer.Pages
{
    #line hidden
    using System;
    using System.Collections.Generic;
    using System.Threading.Tasks;
    using Microsoft.AspNetCore.Components;
#nullable restore
#line 1 "C:\Users\milad\source\repos\LibraryServer\LibraryServer\_Imports.razor"
using System.Net.Http;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "C:\Users\milad\source\repos\LibraryServer\LibraryServer\_Imports.razor"
using Microsoft.AspNetCore.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "C:\Users\milad\source\repos\LibraryServer\LibraryServer\_Imports.razor"
using Microsoft.AspNetCore.Components.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "C:\Users\milad\source\repos\LibraryServer\LibraryServer\_Imports.razor"
using Microsoft.AspNetCore.Components.Forms;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "C:\Users\milad\source\repos\LibraryServer\LibraryServer\_Imports.razor"
using Microsoft.AspNetCore.Components.Routing;

#line default
#line hidden
#nullable disable
#nullable restore
#line 6 "C:\Users\milad\source\repos\LibraryServer\LibraryServer\_Imports.razor"
using Microsoft.AspNetCore.Components.Web;

#line default
#line hidden
#nullable disable
#nullable restore
#line 7 "C:\Users\milad\source\repos\LibraryServer\LibraryServer\_Imports.razor"
using Microsoft.JSInterop;

#line default
#line hidden
#nullable disable
#nullable restore
#line 8 "C:\Users\milad\source\repos\LibraryServer\LibraryServer\_Imports.razor"
using LibraryServer;

#line default
#line hidden
#nullable disable
#nullable restore
#line 9 "C:\Users\milad\source\repos\LibraryServer\LibraryServer\_Imports.razor"
using LibraryServer.Shared;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "C:\Users\milad\source\repos\LibraryServer\LibraryServer\Pages\LibraryItems.razor"
using DAL;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "C:\Users\milad\source\repos\LibraryServer\LibraryServer\Pages\LibraryItems.razor"
using LibraryServer.Models;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "C:\Users\milad\source\repos\LibraryServer\LibraryServer\Pages\LibraryItems.razor"
using Microsoft.Extensions.Configuration;

#line default
#line hidden
#nullable disable
#nullable restore
#line 6 "C:\Users\milad\source\repos\LibraryServer\LibraryServer\Pages\LibraryItems.razor"
using System.Linq;

#line default
#line hidden
#nullable disable
#nullable restore
#line 7 "C:\Users\milad\source\repos\LibraryServer\LibraryServer\Pages\LibraryItems.razor"
using Blazored.SessionStorage;

#line default
#line hidden
#nullable disable
    [Microsoft.AspNetCore.Components.RouteAttribute("/libraryItems")]
    public partial class LibraryItems : Microsoft.AspNetCore.Components.ComponentBase
    {
        #pragma warning disable 1998
        protected override void BuildRenderTree(Microsoft.AspNetCore.Components.Rendering.RenderTreeBuilder __builder)
        {
        }
        #pragma warning restore 1998
#nullable restore
#line 77 "C:\Users\milad\source\repos\LibraryServer\LibraryServer\Pages\LibraryItems.razor"
       

    private class OptionSelector
    {
        public string Value { get; set; }
        public string Name { get; set; }
    }

    public class SessionSelector
    {
        public string Value { get; set; }
    }

    List<LibraryItemModel> libraryItems;

    List<OptionSelector> options = new List<OptionSelector>()
    {
        new OptionSelector { Value = "c.CategoryName", Name = "Category Name"},
        new OptionSelector { Value = "l.Type", Name = "Type" }
    };

    OptionSelector selectedValue;
    public SessionSelector sessionSelector;

    protected override async Task OnInitializedAsync()
    {

        var sessionSelector = new SessionSelector();
        sessionSelector = await session.GetItemAsync<SessionSelector>("session");
        selectedValue = sessionSelector?.Value != null ? this.options.FirstOrDefault(x => x.Name == sessionSelector.Value) : options[0];

        string sql = InitSql(selectedValue.Value);
        libraryItems = await data.LoadData<LibraryItemModel, dynamic>(sql, new { }, config.GetConnectionString("DefaultConnection"));
    }

    protected async Task deleteItem(int id)
    {
        string sql = "delete from libraryitem where Id = @id";

        await data.StoreData(sql, new { Id = id }, config.GetConnectionString("DefaultConnection"));

        await OnInitializedAsync();
    }

    protected async Task OnSelect(ChangeEventArgs e)
    {
        var sessionSelector = new SessionSelector();
        this.selectedValue = this.options.SingleOrDefault(x => x.Value == e.Value.ToString());

        sessionSelector.Value = selectedValue.Name;
        await session.SetItemAsync("session", sessionSelector);

        string selector = e.Value.ToString();
        var sql = InitSql(selector);

        libraryItems = await data.LoadData<LibraryItemModel, dynamic>(sql, new { }, config.GetConnectionString("DefaultConnection"));
    }

    private string InitSql(string selector)
    {
        return "select l.Id, l.Borrower, l.BorrowDate, l.Title, l.Type, c.CategoryName " +
                        " from libraryitem as l " +
                        " left join category as c " +
                        " on l.CategoryId = c.Id " +
                        $" order by {selector} ";
    }

    private bool isPicked(string selector) 
    {
        return selector == selectedValue.Value;
    }

#line default
#line hidden
#nullable disable
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private ISessionStorageService session { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private IConfiguration config { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private IDataAccess data { get; set; }
    }
}
#pragma warning restore 1591
